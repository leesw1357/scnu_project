<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <title>순행</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/src/main/resources/static/index.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=LIBRARY"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services,clusterer,drawing"></script>

    <!--sidebar-->
    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/sidebars/">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="/css/style3.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>





</head>



<body>






<div class="map_wrap">
    <div id="map" style="width:100%;height:100vh;position:relative;overflow:hidden;"></div>

    <!--사이드 메뉴 영역-->
    <div class="sidebar">
        <div class = "closebtn">
        <img src="/img/mark.png" />
        <span>순행</span>
        <a class = "cl" onclick="closeMenu()"><img src = "/img/xbox.png" style = "width: 25px; height: 25px;"></a>
        </div>

        <ul class="nav nav-pills flex-column mb-auto menu-content">
            <li class="nav-item">
                <a href="/scnu" class="nav-link link-dark" aria-current="page">
                    <i class="bi bi-door-open"></i>
                    &nbsp전체글보기
                </a>
            </li>
            <li class="nav-item">
                <a href="/scnu/club" class="nav-link link-dark" aria-current="page">
                    <i class="bi bi-door-open"></i>
                    &nbsp동아리
                </a>
            </li>
            <li>
                <a href="/scnu/school" class="nav-link link-dark">
                    <i class="bi bi-door-open-fill"></i>
                    &nbsp학교 행사
                </a>
            </li>
            <li>
                <a href="/scnu/student" class="nav-link link-dark">
                    <i class="bi bi-door-closed-fill"></i>
                    &nbsp학생회 행사
                </a>
            </li>
            <li>
                <a href="/scnu/scholarship" class="nav-link link-dark">
                    <i class="bi bi-door-closed"></i>
                    &nbsp장학금
                </a>
            </li>
            <li>
                <a href="/scnu/extracurricular" class="nav-link link-dark">
                    <i class="bi bi-door-closed"></i>
                    &nbsp비교과
                </a>
            </li>

            <li>
                <a href="#" class="nav-link link-dark">
                    <i class="bi bi-calendar"></i>
                    &nbsp캘린더
                </a>
            </li>
            <li>
                <a href="#" class="nav-link link-dark">
                    <i class="bi bi-chat"></i>
                    &nbsp채팅
                </a>
            </li>
            <li>
                <a href="#" class="nav-link link-dark">
                    <i class="bi bi-bookmark-dash"></i>
                    내가쓴글
                </a>
            </li>


            <li>
                <a href="/scnu/main/club" class="nav-link link-dark">
                    <i class="bi bi-bookmark-dash"></i>
                    필터 예시 (동아리)
                </a>
            </li>


        </ul>


        <hr>
        <div class="app-info-dropdown">
            <i class="bi bi-gear" style="margin-left: 35px;"></i><button id="app-info-button">앱 정보</button>
            <div class="app-info-content">
                <!-- 다양한 앱 정보 항목을 표시할 수 있음 -->
                <form th:action="@{/logout}" method="post">
                  <button  class="logout-button" onclick="location.href='/'" type="submit" >
                        로그아웃
                    </button>
                </form>
            </div>
        </div>
    </div>
    </div>

<script>
    // 앱 정보 버튼을 클릭하면 드롭다운 메뉴를 열고 닫는 이벤트 핸들러를 추가합니다.
    document.getElementById("app-info-button").addEventListener("click", function () {
        var dropdown = document.querySelector(".app-info-content");
        if (dropdown.style.display === "block") {
            dropdown.style.display = "none";
        } else {
            dropdown.style.display = "block";
        }
    });

    // 다른 곳을 클릭하면 드롭다운 메뉴를 닫습니다.
    window.addEventListener("click", function (event) {
        var dropdown = document.querySelector(".app-info-content");
        if (!event.target.matches("#app-info-button")) {
            if (dropdown.style.display === "block") {
                dropdown.style.display = "none";
            }
        }
    });
</script>

    <!--화면영역-->
    <div id="main">
        <span>
            <button class="openbtn" onclick="openMenu()"><img src="/img/menu4.png">
            </button>
        </span>
    </div>
    <script>
        function openMenu() {
            document.getElementById("main").style.marginLeft = "250px";
            document.querySelector('.sidebar').style.width = "250px";
            document.querySelector('.openbtn').style.display = 'none';
        }

        function closeMenu() {
            document.getElementById("main").style.marginLeft= "0";
            document.querySelector('.sidebar').style.width = "0";
            document.querySelector('.openbtn').style.display = 'block';
        }
    </script>

    <!-- 지도 확대, 축소 컨트롤 div 입니다 -->
    <div class="custom_zoomcontrol">
        <span onclick="zoomIn()"><img src="/img/plus.png" alt="확대"></span>
        <span onclick="zoomOut()"><img src="/img/minus.png" alt="축소"></span>
    </div>
</div>



<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=64810ef38e28e2efe96520c8a962ec06"></script>
<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(34.968901, 127.479367), // 지도의 중심좌표
                level: 4 // 지도의 확대 레벨
            };



    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다



    // 지도 확대, 축소 컨트롤에서 확대 버튼을 누르면 호출되어 지도를 확대하는 함수입니다
    function zoomIn() {
        map.setLevel(map.getLevel() - 1);
    }

    // 지도 확대, 축소 컨트롤에서 축소 버튼을 누르면 호출되어 지도를 확대하는 함수입니다
    function zoomOut() {
        map.setLevel(map.getLevel() + 1);
    }


    var imageSrc = "/img/marker.png";

    var positions = [];

    // 추가 10 19

    fetch('/api/main/student')
        .then(function(response) {
            if (response.ok) {
                return response.json(); // JSON 형식의 데이터를 받아올 때
                // 또는 return response.text(); // 텍스트 데이터를 받아올 때
            }
            throw new Error('네트워크 상태가 좋지 않습니다.');
        })
        .then(function(data) {
            // 데이터를 활용하여 작업을 수행
            for(var i = 0;i<Object.keys(data).length;i++){
                var content = {
                    title: data[i].title,
                    latlng: new kakao.maps.LatLng(data[i].latitude, data[i].longitude),
                    imgsrc : data[i].filepath,
                    place : data[i].place,
                    info : data[i].info,
                    id : data[i].id,
                    latituded: data[i].latitude,
                    category: data[i].category
                }
                positions.push(content);
                console.log(positions)
            };

            for(var i=0;i<positions.length;i++){

                var imageSize = new kakao.maps.Size(24, 35);

                // 마커 이미지를 생성합니다
                var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

                // 마커를 생성합니다
                var marker = new kakao.maps.Marker({
                    map: map, // 마커를 표시할 지도
                    position: positions[i].latlng, // 마커를 표시할 위치
                    title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                    image : markerImage // 마커 이미지
                });
                var data = positions[i];
                displayMarker(data);
            }


            function displayMarker(data){
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: data.latlng
                })
                console.log(data);
                var overlay = new kakao.maps.CustomOverlay({
                    position: marker.getPosition()
                });
                var content = document.createElement('div');
                content.setAttribute("class","wrap");

                var info = document.createElement('div');
                info.setAttribute("class","info");
                content.appendChild(info);

                var title = document.createElement('div');
                title.setAttribute("class","title");
                info.appendChild(title);
                title.innerHTML = data.title ;

                var close = document.createElement('btn');
                close.setAttribute("class","btn btn-primary");
                close.setAttribute("style","float:right");
                close.innerHTML='닫기';
                title.appendChild(close);

                var body = document.createElement('div');
                body.setAttribute("class","body");
                info.appendChild(body);

                var img = document.createElement('div');
                body.appendChild(img);
                img.setAttribute("class","img");

                var imgsrg = document.createElement('img')
                img.appendChild(imgsrg);
                imgsrg.setAttribute("src",data.imgsrc);
                imgsrg.setAttribute("style","position: absolute;top: 0px;left: 0px;width: 73px;height: 71px;border: 0px solid #ddd;color: #888;overflow: hidden;");

                var desc = document.createElement('div');
                body.appendChild(desc);
                desc.setAttribute("class","desc");

                var ellipsis = document.createElement('div');
                desc.appendChild(ellipsis);
                ellipsis.setAttribute("class","ellipsis");
                ellipsis.innerHTML = data.info;

                var jibun_ellipsis =document.createElement('div');
                desc.appendChild(jibun_ellipsis);
                jibun_ellipsis.setAttribute("class","jibun ellipsis");
                jibun_ellipsis.innerHTML = data.place;

                var sang = document.createElement('a');
                desc.appendChild(sang);
                sang.setAttribute("href","/scnu/"+data.category +"/"+data.id);
                sang.setAttribute("class","link");
                sang.innerHTML = "상세보기";




                close.onclick = function () {
                    overlay.setMap(null);
                }
                overlay.setContent(content);

                kakao.maps.event.addListener(marker, 'click', function() {
                    overlay.setMap(map);
                });
            }



        })



        .catch(function(error) {
            console.log('오류가 발생했습니다.', error);
        });

</script>


</body>
<style>

    p{
        font-weight: 900;
        font-size: large;
    }
</style>
</html>